(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{"+O9i":function(e,t,i){},mx9K:function(e,t,i){"use strict";i.r(t);var a={name:"addRole",props:{treeDisabled:{type:Boolean,default:!0},justLook:{type:Boolean,default:!0},areaTree:{type:Array,default:function(){return[]}},treeData2:{type:Array,default:function(){return[]}},isNewAdd:{type:Boolean,default:!1},dialogVisible:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},addRoleForm:{type:Object,default:function(){}}},data:function(){return{rules:{enable:[{required:!0,validator:function(e,t,i){console.log(t),!1===t||t?i():i(new Error("请选择是否启用"))},trigger:"blur"}],roleName:this.$rules.validate("请输入角色名称",10),remark:this.$rules.validate("",50,!1)},sites:[],options:[{label:"启用",value:!0},{label:"禁用",value:!1}],treeData:[],defaultProps:{children:"children",label:"authName"},visible:this.dialogVisible,expand:[],checked:[],currentKeys:[],formLabelWidth:"94px",roleOptions:[],checkList:[]}},mounted:function(){this.getList()},methods:{getPageIdArr:function(e){var t=[];return this.treeData.forEach((function(i,a){i.guid===e&&i.children&&i.children.length&&i.children.forEach((function(e,i){t.push(e.guid)}))})),t},changeCheck:function(e,t){if(t.checkedKeys.indexOf(e.guid)>=0)this.uniteChildSame(e,!0),2===e.authType&&this.$refs.dataTree.setChecked(e.parentId,!0);else{if(2===e.authType){var i=this.getPageIdArr(e.parentId),a=!0;i.forEach((function(e,i){t.checkedKeys.indexOf(e)>=0&&(a=!1)})),a&&this.$refs.dataTree.setChecked(e.parentId,!1)}e.children&&e.children.length&&this.uniteChildSame(e,!1)}},uniteChildSame:function(e,t){if(!e.disabled)if(this.$refs.dataTree.setChecked(e.guid,t),e.children&&e.children.length)for(var i=0;i<e.children.length;i++)e.children[i].disabled||this.uniteChildSame(e.children[i],t);else e.parentId&&this.$refs.dataTree.setChecked(e.parentId,t)},selectedParent:function(e){var t=this.$refs.dataTree.getNode(e);void 0!==t.parent.key&&(this.$refs.tree.setChecked(t.parent,!0),this.selectedParent(t.parent))},uncheckChildren2:function(e){var t=this;return function e(i){i.forEach((function(i,a){if(i.isCheck=!0,t.checked.indexOf(i.guid)<0){var l=t.copySimple(t.checked);l.push(i.guid),t.checked=l}console.log(i.guid),i.children&&i.children.length&&e(i.children)}))}(e),e},uncheckChildren:function(e){var t=this;return function e(i){i.forEach((function(i,a){i.isCheck=!1,t.checked.indexOf(i.guid)>=0&&t.checked.splice(t.checked.indexOf(i.guid),1),i.children&&i.children.length&&e(i.children)}))}(e),e},changeSite:function(){this.addRoleForm.portOneLevelId=this.$getPortId(1,this.sites,this.areaTree),this.addRoleForm.portTwoLevelId=this.$getPortId(2,this.sites,this.areaTree)},getList:function(){var e=this,t={};this.addRoleForm.guid&&(t.roleId=this.addRoleForm.guid),this.$request.getAuthTree(t).then((function(t){e.expand=[],e.checked=[],console.log(t),e.getChecked(t.data,null)}))},getChecked:function(e,t){var i=this,a=this.copySimple(e),l=[],d=[];!function e(t,a){t.forEach((function(t,s){i.justLook&&(t.disabled="disabled"),t.isChange||(t.disabled="disabled"),1===t.authType&&t.isCheck&&l.indexOf(t.guid)<0&&l.push(t.guid),3===t.authType&&t.isCheck&&(l.indexOf(t.guid)<0&&l.push(t.guid),a&&d.indexOf(a.guid)<0&&d.push(a.guid)),2===t.authType&&t.isCheck&&(l.indexOf(t.guid)<0&&l.push(t.guid),d.indexOf(t.guid)<0&&d.push(t.guid)),t.children&&t.children.length&&e(t.children,t)}))}(a,t),this.$refs.dataTree.setCheckedKeys(l),this.expand=d,this.treeData=a},submitRole:function(){var e=this;if(this.checkList=[],this.$refs.dataTree.getCheckedNodes().forEach((function(t,i){e.checkList.indexOf(t.guid)<0&&e.checkList.push(t.guid)})),this.checkList.length<1)return this.$message({message:"请分配角色功能权限",type:"warning"}),!1;this.$refs.ruleForm.validate((function(t){if(!t)return!1;var i={roleName:e.addRoleForm.roleName,enable:e.addRoleForm.enable,remark:e.addRoleForm.remark,roleLeave:e.addRoleForm.roleLeave,authList:e.checkList,guid:e.addRoleForm.guid};e.addRoleForm.guid?e.$request.editRole(i).then((function(t){e.$emit("updateSuccess",i),e.$message({message:"编辑成功!",type:"success"}),e.closeCallback()})):e.$request.addRole(i).then((function(t){e.$emit("addSuccess"),e.$message({message:"添加成功!",type:"success"}),e.closeCallback()}))}))},isAllChecked:function(e){var t=0,i=!1;return e.forEach((function(e,i){e.isCheck&&t++})),t===e.length&&(i=!0),i},closeCallback:function(){this.$emit("editCallback")},getCheckedNodes:function(){}}},l=(i("y55E"),i("KHd+")),d=Object(l.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{"close-on-click-modal":e.justLook,width:"700px",visible:e.visible,"destroy-on-close":""},on:{"update:visible":function(t){e.visible=t},close:e.closeCallback}},[i("div",{staticClass:"dialogTitleDiy"},[e._v(e._s(!e.justLook&&e.addRoleForm.guid?"编辑角色":e.justLook?"查看角色":"添加角色"))]),e._v(" "),i("div",{staticClass:"addRoleBoxWrap"},[i("div",{staticClass:"addRoleBox"},[i("el-form",{ref:"ruleForm",attrs:{model:e.addRoleForm,rules:e.rules,disabled:e.justLook,"hide-required-asterisk":e.justLook}},[i("el-form-item",{attrs:{label:"角色名称:","label-width":e.formLabelWidth,prop:"roleName"}},[i("el-input",{attrs:{placeholder:"请输入角色名称",size:"small"},model:{value:e.addRoleForm.roleName,callback:function(t){e.$set(e.addRoleForm,"roleName",t)},expression:"addRoleForm.roleName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"是否启用:","label-width":e.formLabelWidth,prop:"enable"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",clearable:!1,placeholder:"是否启用"},model:{value:e.addRoleForm.enable,callback:function(t){e.$set(e.addRoleForm,"enable",t)},expression:"addRoleForm.enable"}},e._l(e.options,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"备注:","label-width":e.formLabelWidth,prop:"remark"}},[i("el-input",{attrs:{placeholder:"请输入备注",size:"small"},model:{value:e.addRoleForm.remark,callback:function(t){e.$set(e.addRoleForm,"remark",t)},expression:"addRoleForm.remark"}})],1)],1)],1),e._v(" "),i("div",{staticClass:"datatable2"},[i("p",{staticClass:"rrrl"},[e._v("分配权限:")]),e._v(" "),i("div",{staticClass:"dataTable"},[i("el-tree",{ref:"dataTree",attrs:{size:"medium",data:e.treeData,"check-strictly":"",disabled:e.justLook,"show-checkbox":"","node-key":"guid","default-expanded-keys":e.expand,props:e.defaultProps},on:{check:e.changeCheck}})],1)])]),e._v(" "),e.justLook?e._e():i("div",{staticClass:"btn"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitRole}},[e._v(e._s(e.addRoleForm.guid?"编辑":"新增"))]),e._v(" "),i("el-button",{attrs:{type:"info"},on:{click:e.closeCallback}},[e._v("取消")])],1)])}),[],!1,null,"bddc3c72",null);t.default=d.exports},y55E:function(e,t,i){"use strict";i("+O9i")}}]);